<lib name="jquery.ui" />
<style>
.dep{
	padding-left:20px;
}
.warning{
	color:red;
}
.selectUnistallType{
	display:none;
}
.selectUnistallTypeItem{
	padding-left:20px;
}
.selectDisableType{
	display:none;
}
.selectDisableTypeItem{
	padding-left:20px;
}
#dialog{
	display:none;
}
</style>
<script type='text/javascript'>
function changePriority(name,priority){
	window.location='/?c=org.opencomb.coresystem.system.ExtensionManager&act=changePriority&name='+name+'&priority='+priority;
}
function selectUnistallType(o,sExtName){
	jQuery('#dialog').dialog({
		buttons:{
			'确定':function(){
				jQuery(this).dialog('close');
				var code = jQuery(this).find('input[name="code"]').attr('checked');
				console.log(code);
				var sCode = '';
				if(code=='checked'){
					sCode = 'remove';
				}else{
					sCode = 'keep';
				}
				var data = jQuery(this).find('input[name="data"]').attr('checked');
				console.log(data);
				var sData = '';
				if(data=='checked'){
					sData = 'checked';
				}else{
					sData = 'keep';
				}
				window.location='/?c=org.opencomb.coresystem.system.ExtensionManager&act=uninstall&name='+sExtName+'&code='+sCode+'&data='+sData;
			},
			'取消':function(){
				jQuery(this).dialog('close');
			}
		},
		bgiframe:true,
		title:'是否保留数据'
	});
}
</script>
<msgqueue />
<h2>已经启用的扩展</h2>
<foreach for="$arrPriority" item="arrExtName" key="nPriority">
	<h3>优先级：{=$nPriority}</h3>
	<table>
		<tr><th>name</th><th>title</th><th>version</th><th>dependence</th><th>禁用</th><th>卸载</th><th>operator</th></tr>
	<foreach for="$arrExtName" item="sExtName">
		<tr>
			<td>{=$sExtName}</td>
			<td>{=$arrEnabledExtensions[$sExtName]->metainfo()->title()}</td>
			<td>{=$arrEnabledExtensions[$sExtName]->metainfo()->version()}</td>
			<td>
				<if "$aDependence=$arrEnabledExtensions[$sExtName]->metainfo()->dependence()">
					<ul class='dep'>
						<foreach for="$aDependence->iterator()" item="dep">
							<li>{=$dep->itemName()}</li>
						</foreach>
					</ul>
				<else />
					无
				</if>
			</td>
			<td>
				<a href='/?c=org.opencomb.coresystem.system.ExtensionManager&act=disable&name={=$sExtName}'>禁用</a>
				<if 'isset($arrDependenceBy[$sExtName])'>
					<div class="recursionDisableList warning">
						将会禁用以下扩展：
						<ul>
							<foreach for='$arrDependenceBy[$sExtName]' item='sDepName'>
								<li>{=$sDepName}</li>
							</foreach>
						</ul>
					</div>
				</if>
			</td>
			<td>
				<a href='#' onclick="selectUnistallType(this,'{=$sExtName}')">卸载</a>
			</td>
			<td>
				更改优先级<select onchange="changePriority('{=$sExtName}',this.value)">
					<loop end='9' var='n'>
						<if '$n == $nPriority'>
							<option value='{=$n}' selected='selected'>{=$n}</option>
						<else />
							<option value='{=$n}'>{=$n}</option>
						</if>
					</loop>
				</select>
			</td>
		</tr>
	</foreach>
	</table>
</foreach>
<div id="dialog">
	<input type='checkbox' name='code' />清除源代码
	<br />
	<input type='checkbox' name='data' />清除数据
</div>
<h2>禁用的扩展</h2>
<table>
	<tr><th>name</th><th>title</th><th>version</th><th>启用</th></tr>
	<foreach for="$arrDisabledExtensionMetainfos" item="aExtensionMetainfo">
		<tr>
			<td>{=$aExtensionMetainfo->name()}</td>
			<td>{=$aExtensionMetainfo->title()}</td>
			<td>{=$aExtensionMetainfo->version()}</td>
			<td>
				<a href='/?c=org.opencomb.coresystem.system.ExtensionManager&act=enable&name={=$aExtensionMetainfo->name()}'>启用</a>
			</td>
		</tr>
	</foreach>
</table>
